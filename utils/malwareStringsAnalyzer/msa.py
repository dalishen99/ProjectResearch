from lib.core import Core
import sys, getopt

def usage():
    print """$> python msa.py [-p/--path=](PATH_OF_MALWARE_BIN) [-v/--vt](VIRUS_TOTAL_API_KEY) [-h/--help]"""

def exit_error():
    usage()
    sys.exit(2)

def getopts(argv):
    try:
        opts, args = getopt.getopt(argv, "hp:v:", ["help", "path=", "vt="])
    except getopt.GetoptError:
        exit_error()
    return opts


if __name__ == '__main__':
    opts = getopts(sys.argv[1:])

    if opts == []:
        exit_error()

    selected_opts = {"path" : None, "vt": None}

    for opt, arg in opts:
        if opt in ("-h", "--help"):
            exit_error()
        elif opt in ("-p", "--path"):
            selected_opts["path"] = arg
        elif opt in ("-v", "--vt"):
            selected_opts["vt"] = arg

    if selected_opts["path"] is None:
        exit_error()

    core = Core(selected_opts["path"], selected_opts["vt"])
    if core.load_strings():
        core.run()
    else:
        exit_error()
